## 스레드를 많이 쓸수록 성능이 좋아질까?

모호하면서 추상적인 질문이므로 종합적으로 논리있게 정리해서 성능과 연관지어 얘기해볼 필요가 있다

스레드를 많이 사용한다라는 의미는 애플리케이션은 더 작은 작업들로 잘게 쪼개서 동시에 실행이 가능한 성격의 애플리케이션이 전제가 된다

애플리케이션의 동작이 순차적인 특징을 가진다면, 잘게 쪼개어 동시에 실행하기에 매우 어려운 성격의 애플리케이션이 되고 스레드를 많이 쓰려고 해도 한계를 지닌다

### 콘텍스트 스위칭

코어에서 실행되던 스레드가 다른 스레드로 바뀔때마다 콘텍스트 스위칭이 CPU 코어에서 발생된다. 

코어에서 스위칭 작업이 발생되면 애플리케이션 코드가 실행되지 않는다

이 때 발생되는 스위칭 타임은 멀티 스레딩으로 동작하기 위해 필요하기 때문에 오버헤드(간접비용)가 발생된다

그럼 코어 수는 고정되어 있는데 스레드는 많아질수록 오버헤드도 많아지고 콘텍스트 스위칭도 많아진다

이러면 스레드가 계속 늘어나도 오버헤드에 의해 성능의 한계가 드러나게 된다

### CPU, I/O bound

<img src="https://github.com/Geol2/Today-I-Learned/blob/main/CS/images/thread.png?raw=true" />

#### CPU bound 애플리케이션

CPU를 많이 사용하기 때문에 코어 수와 비슷한 수준 이상으로 스레드 수를 늘려봤자 별 이점이 없다고 한다

각 코어에서 경합하는 스레드 수가 많아질수록 콘텍스트 스위칭 때문에 오버헤드만 많아져 성능에 안좋은 영향을 미친다

#### I/O bound 애플리케이션

I/O 작업이 많기 때문에 CPU 가 놀고 있는 시간이 많으므로 코어 수보다 두 배 이상 스레드 수를 늘려주는 것이 오버헤드가 늘긴해도 코어들을 더 효율적으로 쓸 수 있기 때문에 성능 면에서 이점이 더 크지만 몇 개의 쓰레드를 미리 만들어 놓을지 여러 상황을 고려해서 결정하는 것이 필요하다, 마찬가지로 그렇다고 스레드가 너무 많으면 성능에 안 좋다

---
- CPU bound 애플리케이션 : 하드디스크에 저장되어있는 프로그램이 메모리에 올라가게 되면 프로세스가 되고 스케줄러에 의해 실행될 프로세스가 CPU에 올라가 실행된다. CPU가 프로세스를 실행시키는 시간이 많은 애플리케이션 (영상 편집, 머신러닝 등)
- I/O bound 애플리케이션 : 파일 읽기/쓰기, 네트워크의 어딘가와 데이터 교환, 입출력 장치와 데이터를 주거나 받는 것 등을 하고자 하드 디스크에 접근하기 위해 대기하는 시간이 많은 애플리케이션 (일반적인 백엔드 API 서버)