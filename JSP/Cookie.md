# Cookie

쿠키는 웹 브라우저가 보관하는 데이터

쿠키는 웹 서버와 브라우저 둘다 생성할 수 있다.

1. 쿠키 생성 단계 : 브라우저 요청으로 서버에서 쿠키를 응답한다

2. 쿠키 저장 단계 : 브라우저에서 쿠키를 저장한다

3. 쿠키 전송 단계 : 저장된 쿠키를 요청이 있을 때마다 서버에 전송한다

## 쿠키 목적

1. 세션 관리 : 서버에 저장해야할 로그인, 장바구니, 스코어 등의 정보 관리
2. 개인화 : 사용자 선호, 테마 등의 세팅
3. 트래킹 : 사용자 행동을 기록하고 분석

## 쿠키 만들기

Set-Cookie HTTP 응답 헤더는 서버로부터 사용자 에이전트로 전송됩니다. 간단한 쿠키는 다음과 같이 설정될 수 있다

```
Set-Cookie: <cookie-name>=<cookie-value>
```

서버 헤더는 클라이언트에게 쿠키를 저장하라고 전달

```
HTTP/1.0 200 OK
Content-type: text/html
Set-Cookie: yummy_cookie=choco
Set-Cookie: tasty_cookie=strawberry

[page content]
```

브라우저는 Cookie 헤더를 사용하여 서버로 이전에 저장했던 모든 쿠키들을 회신할 것

```
GET /sample_page.html HTTP/1.1
Host: www.example.org
Cookie: yummy_cookie=choco; tasty_cookie=strawberry
```

PHP, NodeJS ... 서버측 애플리케이션에서 Set-Cookie헤더를 사용해서 만들 수도 있다

## 세션쿠키

사용자가 사이트 탐색 시에 관련한 설정들과 선호사항을 저장하는 임시 쿠키

현재 브라우저의 세션이 끝날 때 삭제되는 쿠키로 메모리에 저장된다

## 지속쿠키

지속쿠키는 브라우저를 닫거나 컴퓨터를 재시작해도 남아있는 것으로 더 길게 유지할 수 있으며 디스크에 저장된다

`Expire`, `Max-Age` 속성에 명시된 날짜에 삭제되거나 명시된 기간 이후에 삭제된다

사용자 로그인 항상 유지와 같은 곳에 사용된다

## 구성요소

- name(이름) : 각각의 쿠키를 구별하는데 사용되는 이름
- value(값) : 쿠키 이름과 관련된 값
- expire(유효시간) : 쿠키의 유지시간
- domain(도메인) : 쿠키를 전송할 도메인, 쿠키가 전송되게 될 호스트들을 명시(서브도메인 포함)
- path(경로) : 쿠키를 전송할 요청 경로, 웹사이트 일부만 쿠키를 적용할 수 있게 하는 속성
- secure(보안연결) : HTTPS 상의 암호된 요청일 경우에만 전송
- HttpOnly : HTTP 요청이 있을 경우에만 전송

만약 `Path=/docs`이 설정되면, 다음의 경로들은 모두 매치

```
/docs
/docs/Web/
/docs/Web/HTTP
```

## 쿠키의 도메인

쿠키는 생성한 서버에만 전송된다. 예를 들어, `http://javacan.somehost.com` 에 연결해서 생성된 쿠키는 다른 사이트로 연결할 때 전송되지 않는다.

# 트래킹 및 프라이버시

이 도메인이 현재 보고 있는 페이지의 도메인과 동일하면 퍼스트파티 쿠키, 도메인이 다르면 서드파티 쿠키

도메인이 다르다는 의미는 예를 들어 다른 광고 배너 컴포넌트나 이미지, 트래킹에 쓰이는데 서드파티 쿠키를 공개하지 않는데 쿠키 사용이 밝혀질 경우 접속자의 신뢰를 잃을 수도 있으므로 쿠키에 대한 공개를 하면 부정적인 효과를 없앨 수 있다