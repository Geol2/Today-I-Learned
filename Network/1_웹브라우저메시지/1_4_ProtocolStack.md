# 프로토콜 스택에 메시지 송신을 의뢰한다.

## 데이터 송/수신 동작의 개요

IP 주소를 조사했으면 IP 주소의 상대, 액세스 대상 웹서버에 메시지를 송신하도록 OS 내부에 있는 프로토콜 스택에 의뢰한다고 나와있다.

프로토콜 스택
```
The protocol stack or network stack is an implementation of a computer networking protocol suite or protocol family. 
Some of these terms are used interchangeably but strictly speaking, the suite is the definition of the communication protocols, and the stack is the software implementation of them.
프로토콜 스택이나 네트워크 스택은 컴퓨터 네트워크 프로토콜 슈트 또는 프로토콜 쳬계의 구현이다.
용어들 중 어떤 것들은 같은 의미로 사용이 되긴 하지만, 엄격히 말해서 이 슈트는 통신 프로토콜의 정의이고 이 스택은 프로토콜의 소프트웨어 구현이다.
```
라고 나와있는데, 어려운 것 같다...

- OS 내부의 프로토콜 스택에 메시지 송신 동작을 의뢰할 때는 Socket 라이버러리 프로그램 부품을 결정된 순번대로 호출.

소켓이라는 파이프를 통해서 통신이 되는데, 실제로 파이프가 있는 것은 아니지만 이미지처럼 이해하면 되고, 이 파이프의 양끝점을 소켓이라고 부른다고 한다.
```
(클라이언트 <-> 프로토콜 스택) <-> 네트워크 <-> 서(프로토콜 스택 <-> 서버 프로그램)
```
데이터를 모두 전달하면 연결했던 파이프가 분리됨

요약. (OS내부의 프로토콜 스택)
1. 소켓을 만듭니다.
2. 서버측의 소켓에 파이프를 연결합니다.
3. 데이터를 송, 수신합니다.
4. 파이프를 분리하고 소켓을 말소합니다.


## 소켓 작성 단계

|  서버   | 프로토콜 스택   |   애플리케이션   |
|---------|----------------|----------------|
| DNS 서버| 제어정보의 흐름 |    메모리영역    |
|         |                | 디스크립터(준비) |
|         | 제어정보의 흐름 |  connect(접속)  |
| 웹 서버 | 데이터의 흐름   |  write(송신)    |
|         | 데이터의 흐름   |   수신데이터    |
|         | 데이터의 흐름   | close(연결끊기) |

디스크립터란, 애플리케이션이 각 소켓을 식별하기 해서 메모리에 기록하기 위해서 생기는 것.

## 파이프를 연결하는 접속 단계
- Socket 라이브러리의 connect 호출을 실행.
(디스크립터, 서버의 IP 주소, 포트 번호)

## 메시지를 주고받는 송/수신 단계
- 송신 데이터
  - Socket 라이브러리의 write 호출을 실행.
  - HTTP의 리퀘스트 메시지가 송신데이터.

- 수신 동작
  - Socket 라이브러리의 read 호출을 실행.
  - 수신한 응답 메시지를 저장하기 위한 메모리 영역을 수신 버퍼.

## 연결 끊기 단계에서 송/수신이 종료된다
- Socket 라이버러리의 close 호출.
- 소켓 사이를 연결한 파이프와 같은 것이 분리되고 소켓 또한 말소.

- HTTP 동작.
  - 서버 측에서 close 호출.
  - 클라이언트 측에서 소켓은 연결 끊기 단계
  - 브라우저가 read로 수신 동작을 의뢰하고 read는 수신한 데이터를 건네주고 송수신이 완료되어 연결이 끊기고 브라우저에 통지
  - 브라우저에도 close를 호출하여 연결 끊기 단계
